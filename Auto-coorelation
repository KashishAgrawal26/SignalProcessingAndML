import numpy as np
import matplotlib.pyplot as plt
from scipy.fft import fft, ifft, fftfreq
from scipy.signal import correlate

# Parameters
num_samples = 100000  # Number of samples
fs = 1000  # Sampling frequency in Hz
fd = 10  # Doppler frequency
t = np.arange(num_samples) / fs  # Time array

# Generate white noise (flat spectrum)
white_noise = np.random.normal(0, 1, num_samples)

# Frequency axis
frequencies = fftfreq(num_samples, 1/fs)

# Define the filter H(f) for the desired power spectral density (PSD)
def filter_H(f):
    return 1 / (1 + (f / fd)**2)  # Low-pass filter

# Apply the filter in the frequency domain to generate colored noise
white_noise_freq = fft(white_noise)
colored_noise_freq = white_noise_freq * filter_H(np.abs(frequencies))
colored_noise = np.real(ifft(colored_noise_freq))

# Autocorrelation of the colored noise
def autocorrelation(signal):
    result = correlate(signal, signal.conj(), mode='full')
    return result[result.size // 2:]

# Calculate autocorrelation of the colored noise
auto_corr = autocorrelation(colored_noise)

# Normalize the autocorrelation
auto_corr_normalized = auto_corr / np.max(np.abs(auto_corr))

# Time lags for autocorrelation plot
lags = np.arange(0, len(auto_corr)) / fs  # Time lags in seconds

# Limit the x-axis to 20 seconds
max_lag = 20  # seconds
max_lag_index = np.searchsorted(lags, max_lag)

# Plot the autocorrelation for the specified range
plt.figure(figsize=(10, 6))
plt.plot(lags[:max_lag_index], auto_corr_normalized[:max_lag_index], label='Autocorrelation (Real Part)', color='blue')

# Add titles and labels
plt.title('Autocorrelation of Colored Noise')
plt.xlabel('Time Lag (seconds)')
plt.ylabel('Normalized Amplitude')
plt.legend()
plt.grid(True)
plt.xlim(0, max_lag)  # Set x-axis limit to 20 seconds
plt.show()
